<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#1a1a1e">
<title>Guitar Theory Tools</title>
<style>
:root{--bg:#1a1a1e;--sf:#242428;--sf2:#2e2e34;--tx:#e8e6e3;--txd:#8a8a8e;--fw:#b8a89a;--nut:#f5f0e8;--root:#e63946;--m2:#f4a261;--M2:#f4a261;--m3:#2a9d8f;--M3:#2a9d8f;--P4:#457b9d;--TT:#9b5de5;--P5:#e9c46a;--m6:#f77f00;--M6:#f77f00;--m7:#06d6a0;--M7:#06d6a0}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--tx);font-family:-apple-system,BlinkMacSystemFont,'Hiragino Sans','Hiragino Kaku Gothic ProN',Meiryo,sans-serif;min-height:100vh;min-height:-webkit-fill-available;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent;overscroll-behavior:none}
.app{max-width:1440px;margin:0 auto;padding:24px 32px}
header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:14px}
.logo{display:flex;align-items:center;gap:10px}
.logo i{width:36px;height:36px;background:linear-gradient(135deg,var(--P4),#6ba3c7);border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;color:#fff;font-style:normal;box-shadow:0 3px 12px rgba(69,123,157,.3)}
h1{font-size:1.15rem;font-weight:700;letter-spacing:-.3px}h1 em{color:var(--txd);font-weight:400;font-size:.78rem;margin-left:6px;font-style:normal}
.ctrls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.cg{display:flex;flex-direction:column;gap:3px}
.cg label{font-size:.62rem;text-transform:uppercase;letter-spacing:1.2px;color:var(--txd)}
select{background:var(--sf2);color:var(--tx);border:1px solid rgba(255,255,255,.08);border-radius:8px;padding:8px 28px 8px 10px;font-size:14px;cursor:pointer;appearance:none;-webkit-appearance:none;font-family:inherit;min-width:120px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 5 5-5' stroke='%238a8a8e' stroke-width='1.5' fill='none'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 8px center;transition:border-color .2s}
select:focus{outline:none;border-color:var(--root);box-shadow:0 0 0 3px rgba(230,57,70,.15)}
.tabs{display:flex;gap:4px;margin-bottom:16px;border-bottom:1px solid rgba(255,255,255,.06);padding-bottom:8px;overflow-x:auto}
.tab{background:none;border:none;color:var(--txd);font-family:inherit;font-size:.82rem;padding:8px 16px;cursor:pointer;border-radius:8px 8px 0 0;transition:all .2s;-webkit-tap-highlight-color:transparent;white-space:nowrap}
.tab:hover{color:var(--tx);background:var(--sf2)}.tab.on{color:var(--root);background:rgba(230,57,70,.1);border-bottom:2px solid var(--root)}
.tp{display:none}.tp.on{display:block}
/* Fretboard - identical to index */
.fbw{background:var(--sf);border-radius:14px;padding:20px 12px 12px;overflow-x:auto;-webkit-overflow-scrolling:touch;box-shadow:0 6px 24px rgba(0,0,0,.4);border:1px solid rgba(255,255,255,.04)}
.fn{display:flex;margin-bottom:3px;user-select:none}.fn:last-of-type{margin-bottom:0;margin-top:3px}
.fn .sp{width:44px;min-width:44px}.fn span{width:56px;min-width:56px;text-align:center;font-size:.65rem;color:var(--txd);position:relative}
.fn span.hd::after,.fn span.ht::before{content:'‚óè ‚óè';display:block;font-size:.3rem;color:rgba(255,255,255,.2);letter-spacing:2px}.fn span.hd::after{margin-top:-1px}.fn span.ht::before{margin-bottom:-1px}
.fn span.hs::after,.fn span.st::before{content:'‚óè';display:block;font-size:.3rem;color:rgba(255,255,255,.2)}.fn span.hs::after{margin-top:-1px}.fn span.st::before{margin-bottom:-1px}
.fb{position:relative;background:linear-gradient(180deg,#3d2114,#2c1810 30%,#241209 70%,#1e0f08);border-radius:7px;padding:10px 0;overflow:visible}
.dm{display:flex;height:0;position:relative;pointer-events:none}.dm .sp{width:44px;min-width:44px}.dm .dc{width:56px;min-width:56px;position:relative;height:0}
.dm .dc .d{position:absolute;width:11px;height:11px;border-radius:50%;background:radial-gradient(circle at 40% 35%,rgba(255,255,250,.2),rgba(180,175,165,.08));box-shadow:inset 0 1px 2px rgba(255,255,255,.1);left:50%;transform:translateX(-50%);border:1px solid rgba(255,255,255,.05)}
.sr{display:flex;align-items:center;height:38px;position:relative;min-width:fit-content}
.sl{width:44px;min-width:44px;text-align:center;font-size:.68rem;font-weight:600;color:var(--txd);z-index:2}
.sn{position:absolute;left:44px;right:0;top:50%;transform:translateY(-50%);z-index:0;pointer-events:none}
.fc{width:56px;min-width:56px;height:38px;position:relative;display:flex;align-items:center;justify-content:center}
.fc.nut::after{content:'';position:absolute;right:0;top:0;bottom:0;width:4px;background:var(--nut);border-radius:1px;box-shadow:2px 0 5px rgba(0,0,0,.4);z-index:1}
.fc:not(.nut)::after{content:'';position:absolute;right:0;top:0;bottom:0;width:2px;background:linear-gradient(180deg,rgba(200,185,170,.35),var(--fw),rgba(200,185,170,.35));z-index:1}
.nd{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.6rem;font-weight:700;z-index:3;position:relative;transition:transform .2s cubic-bezier(.34,1.56,.64,1),filter .2s;cursor:pointer;text-shadow:0 1px 2px rgba(0,0,0,.3);box-shadow:0 2px 6px rgba(0,0,0,.35),inset 0 1px 0 rgba(255,255,255,.2);animation:pop .3s cubic-bezier(.34,1.56,.64,1) backwards;line-height:1;-webkit-tap-highlight-color:transparent;touch-action:manipulation;user-select:none}
.nd:hover{transform:scale(1.2);z-index:10}
.nd.pl{transform:scale(1.3);filter:brightness(1.3);box-shadow:0 0 14px 3px currentColor,0 2px 6px rgba(0,0,0,.35)}
@keyframes pop{from{transform:scale(0);opacity:0}to{transform:scale(1);opacity:1}}
.nd.root{background:var(--root);color:#fff;width:31px;height:31px;font-size:.65rem}
.nd.m2{background:var(--m2);color:#1a1a1e}.nd.M2{background:var(--M2);color:#1a1a1e}.nd.m3{background:var(--m3);color:#fff}.nd.M3{background:var(--M3);color:#fff}
.nd.P4{background:var(--P4);color:#fff}.nd.TT{background:var(--TT);color:#fff}.nd.P5{background:var(--P5);color:#1a1a1e}
.nd.m6{background:var(--m6);color:#1a1a1e}.nd.M6{background:var(--M6);color:#1a1a1e}.nd.m7{background:var(--m7);color:#1a1a1e}.nd.M7{background:var(--M7);color:#1a1a1e}
/* Chord grid */
.cg2{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:8px;margin:12px 0}
.cc{background:var(--sf);border:2px solid rgba(255,255,255,.06);border-radius:10px;padding:12px;cursor:pointer;transition:all .2s;text-align:center;-webkit-tap-highlight-color:transparent}
.cc:hover{border-color:rgba(255,255,255,.15);transform:translateY(-2px)}
.cc.on{border-color:var(--root);background:rgba(230,57,70,.08);box-shadow:0 4px 16px rgba(230,57,70,.15)}
.cc .deg{font-size:.65rem;color:var(--txd);margin-bottom:4px}
.cc .cn{font-size:1rem;font-weight:700}
.cc .cns{font-size:.65rem;color:var(--txd);margin-top:4px}
.cc .ct{font-size:.6rem;color:var(--P4);margin-top:2px}
/* Chord-Scale table */
.cst{width:100%;border-collapse:collapse;margin:12px 0;font-size:.75rem}
.cst th{text-align:left;padding:8px 10px;border-bottom:2px solid rgba(255,255,255,.1);color:var(--txd);font-weight:600;font-size:.65rem;text-transform:uppercase;letter-spacing:1px}
.cst td{padding:8px 10px;border-bottom:1px solid rgba(255,255,255,.04)}
.cst tr:hover td{background:rgba(255,255,255,.02)}
.csc{font-weight:700;white-space:nowrap}
.css{display:flex;flex-wrap:wrap;gap:4px}
.cstg{background:var(--sf2);padding:3px 8px;border-radius:12px;font-size:.65rem;cursor:pointer;transition:all .15s;border:1px solid rgba(255,255,255,.04)}
.cstg:hover{border-color:var(--root);color:var(--root)}
.cstg.on{background:rgba(230,57,70,.15);border-color:var(--root);color:var(--root)}
/* Circle */
.crc{display:flex;justify-content:center;align-items:center;padding:20px 0;flex-wrap:wrap;gap:20px}
.crc svg{max-width:380px;width:100%}
.cri{font-size:.75rem;color:var(--txd);max-width:250px}
.cri h3{color:var(--tx);font-size:.9rem;margin-bottom:6px}
.cri .cin{display:flex;flex-wrap:wrap;gap:4px;margin:6px 0}
.cri .cin span{padding:3px 8px;border-radius:12px;font-size:.7rem;font-weight:600}
/* Nav */
.site-nav{display:flex;gap:4px;padding:10px 16px;max-width:1440px;margin:0 auto}
.nav-link{color:var(--txd);text-decoration:none;font-family:inherit;font-size:.75rem;padding:6px 14px;border-radius:8px;background:var(--sf2);border:1px solid rgba(255,255,255,.04);transition:all .2s;-webkit-tap-highlight-color:transparent}
.nav-link:hover{color:var(--tx);border-color:rgba(255,255,255,.12)}.nav-link.active{color:#e63946;background:rgba(230,57,70,.1);border-color:#e63946}
/* Mobile */
@media(max-width:768px){.app{padding:12px;padding-top:env(safe-area-inset-top,12px)}header{flex-direction:column;align-items:stretch;gap:10px;margin-bottom:14px}.logo{justify-content:center}h1{font-size:1rem}h1 em{display:none}.ctrls{width:100%;display:grid;grid-template-columns:1fr 1fr;gap:7px}.cg label{font-size:.55rem}select{min-width:0;width:100%;padding:10px 26px 10px 8px;font-size:16px;border-radius:10px}.fbw{padding:10px 6px 6px;border-radius:10px}.fn .sp,.dm .sp,.sl{width:30px;min-width:30px;font-size:.58rem}.fn span{width:44px;min-width:44px;font-size:.55rem}.dm .dc{width:44px;min-width:44px}.fc{width:44px;min-width:44px;height:34px}.sr{height:34px}.sn{left:30px}.nd{width:26px;height:26px;font-size:.52rem}.nd.root{width:28px;height:28px;font-size:.56rem}.cg2{grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:6px}.cc{padding:8px}.cc .cn{font-size:.85rem}.cst{font-size:.65rem}.site-nav{padding:8px 10px}.nav-link{font-size:.68rem;padding:5px 10px}}
@media(max-width:380px){.fn span,.dm .dc,.fc{width:40px;min-width:40px}.fc{height:32px}.sr{height:32px}.nd{width:23px;height:23px;font-size:.48rem}.nd.root{width:25px;height:25px}}
@media(max-height:500px)and(orientation:landscape){.app{padding:6px 10px}header{flex-direction:row;margin-bottom:6px;gap:6px}.ctrls{display:flex;gap:5px}select{padding:4px 22px 4px 6px;font-size:13px}.sr{height:30px}.fc{height:30px}.nd{width:22px;height:22px;font-size:.48rem}.nd.root{width:24px;height:24px}}
</style>
</head>
<body>
<nav class="site-nav"><a href="index.html" class="nav-link">üé∏ Fretboard</a><a href="practice.html" class="nav-link">üéµ Practice</a><a href="theory.html" class="nav-link active">üìñ Theory</a></nav>
<div class="app">
  <header><div class="logo"><i>‚ôØ</i><h1>Theory Tools <em>/ Èü≥Ê•ΩÁêÜË´ñ</em></h1></div></header>
  <div class="tabs">
    <button class="tab on" onclick="stab('dia',this)">üéπ „ÉÄ„Ç§„Ç¢„Éà„Éã„ÉÉ„ÇØ</button>
    <button class="tab" onclick="stab('cs',this)">üìñ „Ç≥„Éº„Éâ‚áî„Çπ„Ç±„Éº„É´</button>
    <button class="tab" onclick="stab('cr',this)">‚≠ï „Çµ„Éº„ÇØ„É´</button>
  </div>
  <!-- Diatonic -->
  <div class="tp on" id="tp-dia">
    <div class="ctrls" style="margin-bottom:10px">
      <div class="cg"><label>Key</label><select id="dia-k"></select></div>
      <div class="cg"><label>Scale</label><select id="dia-t">
        <option value="major">Major / „É°„Ç∏„É£„Éº</option><option value="minor">Minor / „Éû„Ç§„Éä„Éº</option>
        <option value="hminor">Harm Minor / „Éè„Éº„É¢„Éã„ÉÉ„ÇØ„Éû„Ç§„Éä„Éº</option><option value="mminor">Mel Minor / „É°„É≠„Éá„Ç£„ÉÉ„ÇØ„Éû„Ç§„Éä„Éº</option>
      </select></div>
      <div class="cg"><label>Voicing</label><select id="dia-v">
        <option value="triad">Triad / ‰∏âÂíåÈü≥</option><option value="7th">7th / ÂõõÂíåÈü≥</option>
        <option value="9th">9th / ‰∫îÂíåÈü≥</option><option value="6th">6th</option><option value="add9">Add9</option>
      </select></div>
      <div class="cg"><label>Strings</label><select id="dia-r"><option value="6">6Âº¶</option><option value="7">7Âº¶</option></select></div>
      <div class="cg"><label>Frets</label><select id="dia-f"><option value="12">12</option><option value="15">15</option><option value="17">17</option><option value="22">22</option><option value="24" selected>24</option></select></div>
    </div>
    <div class="cg2" id="dia-grid"></div>
    <div class="fbw"><div class="fn" id="dia-ft"></div><div class="fb" id="dia-fb"></div><div class="fn" id="dia-fB"></div></div>
    <div id="dia-nf" style="text-align:center;margin-top:8px;font-size:.75rem;color:var(--txd)"></div>
  </div>
  <!-- Chord-Scale -->
  <div class="tp" id="tp-cs">
    <div class="ctrls" style="margin-bottom:10px">
      <div class="cg"><label>Key</label><select id="cs-k"></select></div>
      <div class="cg"><label>Strings</label><select id="cs-r"><option value="6">6Âº¶</option><option value="7">7Âº¶</option></select></div>
      <div class="cg"><label>Frets</label><select id="cs-f"><option value="12">12</option><option value="15">15</option><option value="17">17</option><option value="22">22</option><option value="24" selected>24</option></select></div>
    </div>
    <div style="overflow-x:auto"><table class="cst" id="cs-tbl"></table></div>
    <div class="fbw" style="margin-top:12px"><div class="fn" id="cs-ft"></div><div class="fb" id="cs-fb"></div><div class="fn" id="cs-fB"></div></div>
    <div id="cs-nf" style="text-align:center;margin-top:8px;font-size:.75rem;color:var(--txd)"></div>
  </div>
  <!-- Circle -->
  <div class="tp" id="tp-cr">
    <div class="ctrls" style="margin-bottom:10px">
      <div class="cg"><label>Key</label><select id="cr-k"></select></div>
      <div class="cg"><label>Scale</label><select id="cr-s"></select></div>
    </div>
    <div class="crc"><svg id="cr-svg" viewBox="0 0 400 400"></svg><div class="cri" id="cr-info"></div></div>
  </div>
</div>
<script>
var N=['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'],FM={'C#':'D‚ô≠','D#':'E‚ô≠','F#':'G‚ô≠','G#':'A‚ô≠','A#':'B‚ô≠'};
var T6={t:[4,9,2,7,11,4],n:['E','A','D','G','B','e'],w:[2.8,2.3,1.8,1.4,1.1,.9],c:['#928880','#9c9286','#a69c90','#b0a69a','#bab0a4','#c4b8ac'],h:[82.41,110,146.83,196,246.94,329.63]};
var T7={t:[11,4,9,2,7,11,4],n:['B','E','A','D','G','B','e'],w:[3.2,2.8,2.3,1.8,1.4,1.1,.9],c:['#88807a','#928880','#9c9286','#a69c90','#b0a69a','#bab0a4','#c4b8ac'],h:[61.74,82.41,110,146.83,196,246.94,329.63]};
var FS=new Set([3,5,7,9,15,17,19,21]),FD=new Set([12,24]);
var DC={'R':'root','m2':'m2','M2':'M2','m3':'m3','M3':'M3','P4':'P4','TT':'TT','P5':'P5','m6':'m6','M6':'M6','m7':'m7','M7':'M7'};
var DJ={'R':'„É´„Éº„Éà','m2':'Áü≠2','M2':'Èï∑2','m3':'Áü≠3','M3':'Èï∑3','P4':'ÂÆåÂÖ®4','TT':'„Éà„É©„Ç§„Éà„Éº„É≥','P5':'ÂÆåÂÖ®5','m6':'Áü≠6','M6':'Èï∑6','m7':'Áü≠7','M7':'Èï∑7'};
var SC={'Major / „É°„Ç∏„É£„Éº':{i:[0,2,4,5,7,9,11],d:['R','M2','M3','P4','P5','M6','M7']},'Nat Minor / „Éä„ÉÅ„É•„É©„É´„Éû„Ç§„Éä„Éº':{i:[0,2,3,5,7,8,10],d:['R','M2','m3','P4','P5','m6','m7']},'Harm Minor / „Éè„Éº„É¢„Éã„ÉÉ„ÇØ„Éû„Ç§„Éä„Éº':{i:[0,2,3,5,7,8,11],d:['R','M2','m3','P4','P5','m6','M7']},'Mel Minor / „É°„É≠„Éá„Ç£„ÉÉ„ÇØ„Éû„Ç§„Éä„Éº':{i:[0,2,3,5,7,9,11],d:['R','M2','m3','P4','P5','M6','M7']},'Maj Penta / „É°„Ç∏„É£„Éº„Éö„É≥„Çø':{i:[0,2,4,7,9],d:['R','M2','M3','P5','M6']},'Min Penta / „Éû„Ç§„Éä„Éº„Éö„É≥„Çø':{i:[0,3,5,7,10],d:['R','m3','P4','P5','m7']},'Blues / „Éñ„É´„Éº„Çπ':{i:[0,3,5,6,7,10],d:['R','m3','P4','TT','P5','m7']},'Dorian / „Éâ„É™„Ç¢„É≥':{i:[0,2,3,5,7,9,10],d:['R','M2','m3','P4','P5','M6','m7']},'Mixolydian / „Éü„ÇØ„ÇΩ„É™„Éá„Ç£„Ç¢„É≥':{i:[0,2,4,5,7,9,10],d:['R','M2','M3','P4','P5','M6','m7']},'Phrygian / „Éï„É™„Ç∏„Ç¢„É≥':{i:[0,1,3,5,7,8,10],d:['R','m2','m3','P4','P5','m6','m7']},'Lydian / „É™„Éá„Ç£„Ç¢„É≥':{i:[0,2,4,6,7,9,11],d:['R','M2','M3','TT','P5','M6','M7']},'Locrian / „É≠„ÇØ„É™„Ç¢„É≥':{i:[0,1,3,5,6,8,10],d:['R','m2','m3','P4','TT','m6','m7']},'Whole Tone / „Éõ„Éº„É´„Éà„Éº„É≥':{i:[0,2,4,6,8,10],d:['R','M2','M3','TT','m6','m7']}};
var NC=['var(--root)','var(--m2)','var(--M2)','var(--m3)','var(--M3)','var(--P4)','var(--TT)','var(--P5)','var(--m6)','var(--M6)','var(--m7)','var(--M7)'];

// Diatonic chord builder
var SDG={major:[0,2,4,5,7,9,11],minor:[0,2,3,5,7,8,10],hminor:[0,2,3,5,7,8,11],mminor:[0,2,3,5,7,9,11]};
var DLB={major:['I','ii','iii','IV','V','vi','vii¬∞'],minor:['i','ii¬∞','III','iv','v','VI','VII'],hminor:['i','ii¬∞','III+','iv','V','VI','vii¬∞'],mminor:['i','ii','III+','IV','V','vi¬∞','vii¬∞']};
function dn(){var a=arguments,m={0:'R',1:'m2',2:'M2',3:'m3',4:'M3',5:'P4',6:'TT',7:'P5',8:'m6',9:'M6',10:'m7',11:'M7'},r=[];for(var i=0;i<a.length;i++)r.push(m[a[i]]||'?');return r}
function buildDia(st){
  var sc=SDG[st],lb=DLB[st],res=[];
  for(var dg=0;dg<7;dg++){
    var n1=sc[dg],n2=sc[(dg+2)%7],n3=sc[(dg+4)%7],n4=sc[(dg+6)%7],n5=sc[(dg+1)%7];
    var i2=((n2-n1)+12)%12,i3=((n3-n1)+12)%12,i4=((n4-n1)+12)%12,i9=((n5-n1)+12)%12,i6=((sc[(dg+5)%7]-n1)+12)%12;
    var tt,sv;
    if(i2===4&&i3===7)tt='';else if(i2===3&&i3===7)tt='m';else if(i2===3&&i3===6)tt='dim';else if(i2===4&&i3===8)tt='aug';else tt='?';
    if(i4===11)sv=tt==='m'?'mMaj7':tt===''?'Maj7':'?7';
    else if(i4===10)sv=tt===''?'7':tt==='m'?'m7':tt==='dim'?'m7‚ô≠5':'?7';
    else if(i4===9)sv=tt==='dim'?'dim7':'?7';else sv='?7';
    if(tt==='aug'&&i4===11)sv='augMaj7';if(tt==='aug'&&i4===10)sv='aug7';
    var n9l=sv.replace('Maj7','Maj9').replace('m7‚ô≠5','m9‚ô≠5').replace('dim7','dim9').replace('m7','m9').replace('mMaj7','mMaj9').replace(/^7$/,'9').replace('aug7','aug9').replace('augMaj7','augMaj9');
    res.push({deg:lb[dg],riv:n1,
      triad:{iv:[0,i2,i3],d:dn(0,i2,i3),l:tt||'Maj'},
      '7th':{iv:[0,i2,i3,i4],d:dn(0,i2,i3,i4),l:sv},
      '9th':{iv:[0,i2,i3,i4,i9],d:dn(0,i2,i3,i4,i9),l:n9l},
      '6th':{iv:[0,i2,i3,i6],d:dn(0,i2,i3,i6),l:tt==='m'?'m6':tt===''?'6':tt+'6'},
      add9:{iv:[0,i9,i2,i3],d:dn(0,i9,i2,i3),l:tt==='m'?'m(add9)':tt===''?'add9':tt+'(add9)'}
    })}return res}
var DIA={};['major','minor','hminor','mminor'].forEach(function(t){DIA[t]=buildDia(t)});

var CSM={'Maj':['Major / „É°„Ç∏„É£„Éº','Lydian / „É™„Éá„Ç£„Ç¢„É≥','Mixolydian / „Éü„ÇØ„ÇΩ„É™„Éá„Ç£„Ç¢„É≥','Maj Penta / „É°„Ç∏„É£„Éº„Éö„É≥„Çø'],'m':['Nat Minor / „Éä„ÉÅ„É•„É©„É´„Éû„Ç§„Éä„Éº','Dorian / „Éâ„É™„Ç¢„É≥','Phrygian / „Éï„É™„Ç∏„Ç¢„É≥','Min Penta / „Éû„Ç§„Éä„Éº„Éö„É≥„Çø'],'dim':['Locrian / „É≠„ÇØ„É™„Ç¢„É≥'],'aug':['Mel Minor / „É°„É≠„Éá„Ç£„ÉÉ„ÇØ„Éû„Ç§„Éä„Éº'],'Maj7':['Major / „É°„Ç∏„É£„Éº','Lydian / „É™„Éá„Ç£„Ç¢„É≥'],'7':['Mixolydian / „Éü„ÇØ„ÇΩ„É™„Éá„Ç£„Ç¢„É≥','Blues / „Éñ„É´„Éº„Çπ'],'m7':['Dorian / „Éâ„É™„Ç¢„É≥','Nat Minor / „Éä„ÉÅ„É•„É©„É´„Éû„Ç§„Éä„Éº','Phrygian / „Éï„É™„Ç∏„Ç¢„É≥','Min Penta / „Éû„Ç§„Éä„Éº„Éö„É≥„Çø'],'m7‚ô≠5':['Locrian / „É≠„ÇØ„É™„Ç¢„É≥'],'dim7':['Harm Minor / „Éè„Éº„É¢„Éã„ÉÉ„ÇØ„Éû„Ç§„Éä„Éº'],'mMaj7':['Harm Minor / „Éè„Éº„É¢„Éã„ÉÉ„ÇØ„Éû„Ç§„Éä„Éº','Mel Minor / „É°„É≠„Éá„Ç£„ÉÉ„ÇØ„Éû„Ç§„Éä„Éº'],'augMaj7':['Mel Minor / „É°„É≠„Éá„Ç£„ÉÉ„ÇØ„Éû„Ç§„Éä„Éº'],'aug7':['Mel Minor / „É°„É≠„Éá„Ç£„ÉÉ„ÇØ„Éû„Ç§„Éä„Éº'],'m9':['Dorian / „Éâ„É™„Ç¢„É≥','Nat Minor / „Éä„ÉÅ„É•„É©„É´„Éû„Ç§„Éä„Éº'],'9':['Mixolydian / „Éü„ÇØ„ÇΩ„É™„Éá„Ç£„Ç¢„É≥'],'Maj9':['Major / „É°„Ç∏„É£„Éº','Lydian / „É™„Éá„Ç£„Ç¢„É≥'],'m6':['Dorian / „Éâ„É™„Ç¢„É≥','Mel Minor / „É°„É≠„Éá„Ç£„ÉÉ„ÇØ„Éû„Ç§„Éä„Éº'],'6':['Major / „É°„Ç∏„É£„Éº','Maj Penta / „É°„Ç∏„É£„Éº„Éö„É≥„Çø'],'add9':['Major / „É°„Ç∏„É£„Éº'],'m(add9)':['Dorian / „Éâ„É™„Ç¢„É≥','Nat Minor / „Éä„ÉÅ„É•„É©„É´„Éû„Ç§„Éä„Éº']};

// Audio
var ax=null;
function ac(){if(!ax)try{ax=new(window.AudioContext||window.webkitAudioContext)}catch(e){return null}if(ax.state==='suspended')ax.resume();return ax}
function pf(fq,v){var c=ac();if(!c)return;v=v||.2;var t=c.currentTime,m=c.createGain();m.connect(c.destination);m.gain.setValueAtTime(0,t);m.gain.linearRampToValueAtTime(v,t+.008);m.gain.exponentialRampToValueAtTime(Math.max(v*.6,.001),t+.08);m.gain.exponentialRampToValueAtTime(Math.max(v*.3,.001),t+.4);m.gain.exponentialRampToValueAtTime(.001,t+1.8);[{r:1,g:1},{r:2,g:.5},{r:3,g:.25},{r:4,g:.15},{r:5,g:.08}].forEach(function(h){var o=c.createOscillator(),g=c.createGain();o.type='triangle';o.frequency.setValueAtTime(fq*h.r,t);g.gain.setValueAtTime(h.g,t);o.connect(g);g.connect(m);o.start(t);o.stop(t+2)})}
function ps(ns,si,f,v){var T=+ns===7?T7:T6;pf(T.h[si]*Math.pow(2,f/12),v||.2)}
function bnd(d,ns,si,f,v){var tc=false;d.addEventListener('touchstart',function(e){e.preventDefault();tc=true;ps(ns,si,f,v);d.classList.add('pl');setTimeout(function(){d.classList.remove('pl')},300)},{passive:false});d.addEventListener('click',function(){if(tc){tc=false;return}ps(ns,si,f,v);d.classList.add('pl');setTimeout(function(){d.classList.remove('pl')},300)})}

function stab(id,el){document.querySelectorAll('.tab').forEach(function(t){t.classList.remove('on')});document.querySelectorAll('.tp').forEach(function(p){p.classList.remove('on')});document.getElementById('tp-'+id).classList.add('on');el.classList.add('on')}
function fk(el){N.forEach(function(n,i){var o=document.createElement('option');o.value=i;o.textContent=FM[n]?n+' / '+FM[n]:n;el.appendChild(o)})}
function fsc(el){Object.keys(SC).forEach(function(k){var o=document.createElement('option');o.value=k;o.textContent=k;el.appendChild(o)})}

// Shared fretboard
function rfb(fbId,ftId,fBId,ns,key,ivs,degs,maxF){
  var T=+ns===7?T7:T6,nst=+ns,map={};ivs.forEach(function(iv,idx){map[(key+iv)%12]=degs[idx]});
  ;[ftId,fBId].forEach(function(id,idx){var el=document.getElementById(id);el.innerHTML='<div class="sp"></div>';for(var f=0;f<=maxF;f++){var s=document.createElement('span');s.textContent=f;if(idx===0){if(FD.has(f))s.className='hd';else if(FS.has(f))s.className='hs'}else{if(FD.has(f))s.className='ht';else if(FS.has(f))s.className='st'}el.appendChild(s)}});
  var fb=document.getElementById(fbId);fb.innerHTML='';var sh=38,th=nst*sh,my=th/2-16,d1=th*.25,d2=th*.75;
  var dm=document.createElement('div');dm.className='dm';dm.innerHTML='<div class="sp"></div>';
  for(var f=0;f<=maxF;f++){var c=document.createElement('div');c.className='dc';if(FS.has(f))c.innerHTML='<div class="d" style="top:'+my+'px"></div>';else if(FD.has(f))c.innerHTML='<div class="d" style="top:'+d1+'px"></div><div class="d" style="top:'+d2+'px"></div>';dm.appendChild(c)}
  fb.appendChild(dm);
  for(var si=nst-1;si>=0;si--){var row=document.createElement('div');row.className='sr';var sn=document.createElement('div');sn.className='sn';sn.style.height=T.w[si]+'px';sn.style.background=T.c[si];sn.style.opacity='.4';row.appendChild(sn);var lb=document.createElement('div');lb.className='sl';lb.textContent=T.n[si];row.appendChild(lb);
    for(var f=0;f<=maxF;f++){var cell=document.createElement('div');cell.className='fc'+(f===0?' nut':'');var ni=(T.t[si]+f)%12;
      if(map[ni]!==undefined){var dg=map[ni],dot=document.createElement('div');dot.className='nd '+DC[dg];dot.textContent=N[ni];dot.style.animationDelay=f*10+'ms';bnd(dot,ns,si,f);cell.appendChild(dot)}
      row.appendChild(cell)}fb.appendChild(row)}}

// ‚ïê‚ïê‚ïê Diatonic ‚ïê‚ïê‚ïê
var diaSel=0;
function rDia(){
  var key=+document.getElementById('dia-k').value,st=document.getElementById('dia-t').value,vc=document.getElementById('dia-v').value,ns=document.getElementById('dia-r').value,fr=+document.getElementById('dia-f').value;
  var dia=DIA[st];if(diaSel>=dia.length)diaSel=0;
  var grid=document.getElementById('dia-grid');grid.innerHTML='';
  dia.forEach(function(ch,idx){
    var root=(key+ch.riv)%12,vd=ch[vc],notes=vd.iv.map(function(iv){return N[(root+iv)%12]});
    var card=document.createElement('div');card.className='cc'+(idx===diaSel?' on':'');
    card.innerHTML='<div class="deg">'+ch.deg+'</div><div class="cn">'+N[root]+(vd.l==='Maj'?'':vd.l)+'</div><div class="cns">'+notes.join(' - ')+'</div><div class="ct">'+vd.d.join(' ')+'</div>';
    card.addEventListener('click',function(){diaSel=idx;rDia();var bf=261.63;vd.iv.forEach(function(iv,i){setTimeout(function(){pf(bf*Math.pow(2,(root+iv)/12),.12)},i*80)})});
    grid.appendChild(card)});
  var ch=dia[diaSel],root=(key+ch.riv)%12,vd=ch[vc];
  rfb('dia-fb','dia-ft','dia-fB',ns,root,vd.iv,vd.d,fr);
  var vn={triad:'Triad','7th':'7th','9th':'9th','6th':'6th',add9:'Add9'};
  document.getElementById('dia-nf').textContent=N[root]+(vd.l==='Maj'?'':vd.l)+' ('+vn[vc]+') „ÅÆ„Ç≥„Éº„Éâ„Éà„Éº„É≥„ÇíË°®Á§∫‰∏≠ ‚Äî „Çø„ÉÉ„Éó„ÅßÈü≥„ÅåÂá∫„Åæ„Åô'}

// ‚ïê‚ïê‚ïê Chord-Scale ‚ïê‚ïê‚ïê
function rCS(){
  var key=+document.getElementById('cs-k').value,ns=document.getElementById('cs-r').value,fr=+document.getElementById('cs-f').value;
  var tbl=document.getElementById('cs-tbl');tbl.innerHTML='<thead><tr><th>Degree</th><th>Triad</th><th>7th</th><th>‰Ωø„Åà„Çã„Çπ„Ç±„Éº„É´</th></tr></thead>';
  var tb=document.createElement('tbody');
  DIA.major.forEach(function(ch){
    var root=(key+ch.riv)%12,tri=ch.triad,sev=ch['7th'];
    var tr=document.createElement('tr');
    tr.innerHTML='<td style="color:var(--txd)">'+ch.deg+'</td><td class="csc">'+N[root]+(tri.l==='Maj'?'':tri.l)+'</td><td class="csc">'+N[root]+sev.l+'</td><td></td>';
    var td=tr.querySelector('td:last-child'),div=document.createElement('div');div.className='css';
    var ss=new Set();(CSM[sev.l]||[]).forEach(function(s){ss.add(s)});(CSM[tri.l==='Maj'?'Maj':tri.l]||[]).forEach(function(s){ss.add(s)});
    ss.forEach(function(sc){var tag=document.createElement('span');tag.className='cstg';tag.textContent=sc;
      tag.addEventListener('click',function(){document.querySelectorAll('.cstg').forEach(function(t){t.classList.remove('on')});tag.classList.add('on');var scD=SC[sc];if(scD){rfb('cs-fb','cs-ft','cs-fB',ns,root,scD.i,scD.d,fr);document.getElementById('cs-nf').textContent=N[root]+' '+sc+' „ÇíË°®Á§∫‰∏≠Ôºà'+N[root]+sev.l+' ‰∏ä„Åß‰ΩøÁî®Ôºâ'}});
      div.appendChild(tag)});
    td.appendChild(div);tb.appendChild(tr)});
  tbl.appendChild(tb);
  document.getElementById('cs-fb').innerHTML='';document.getElementById('cs-nf').textContent='„Çπ„Ç±„Éº„É´Âêç„Çí„Çø„ÉÉ„Éó„Åô„Çã„Å®ÊåáÊùø„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô'}

// ‚ïê‚ïê‚ïê Chromatic Circle ‚ïê‚ïê‚ïê
function rCR(){
  var key=+document.getElementById('cr-k').value,sn=document.getElementById('cr-s').value,sc=SC[sn];
  var sNotes=new Set(sc.i.map(function(iv){return(key+iv)%12}));
  var cx=200,cy=200,r=160,ri=120,svg=document.getElementById('cr-svg'),h='';
  h+='<circle cx="'+cx+'" cy="'+cy+'" r="'+(r+10)+'" fill="none" stroke="rgba(255,255,255,.04)" stroke-width="1"/>';
  var sp=[];for(var i=0;i<12;i++){if(sNotes.has(i)){var a=(i-3)*30*Math.PI/180;sp.push({ni:i,x:cx+r*Math.cos(a),y:cy+r*Math.sin(a)})}}
  for(var i=0;i<sp.length;i++){var nx=sp[(i+1)%sp.length];h+='<line x1="'+sp[i].x+'" y1="'+sp[i].y+'" x2="'+nx.x+'" y2="'+nx.y+'" stroke="rgba(255,255,255,.08)" stroke-width="1"/>'}
  var ra=(key-3)*30*Math.PI/180,p5=(key+7)%12;
  if(sNotes.has(p5)){var pa=(p5-3)*30*Math.PI/180;h+='<line x1="'+(cx+r*Math.cos(ra))+'" y1="'+(cy+r*Math.sin(ra))+'" x2="'+(cx+r*Math.cos(pa))+'" y2="'+(cy+r*Math.sin(pa))+'" stroke="var(--P5)" stroke-width="2" opacity=".3"/>'}
  for(var i=0;i<12;i++){var a=(i-3)*30*Math.PI/180,x=cx+r*Math.cos(a),y=cy+r*Math.sin(a),ins=sNotes.has(i),isR=i===key,nr=isR?22:ins?18:14,fl=isR?'var(--root)':ins?NC[(i-key+12)%12]:'var(--sf2)',tf=ins?'#fff':'var(--txd)',op=ins?1:.4;
    h+='<g opacity="'+op+'"><circle cx="'+x+'" cy="'+y+'" r="'+nr+'" fill="'+fl+'" stroke="rgba(255,255,255,'+(ins?.15:.06)+')" stroke-width="1.5"/><text x="'+x+'" y="'+y+'" text-anchor="middle" dominant-baseline="central" fill="'+tf+'" font-size="'+(isR?14:12)+'" font-weight="'+(isR?700:600)+'" font-family="-apple-system,monospace">'+N[i]+'</text></g>';
    if(ins){var di=sc.i.indexOf((i-key+12)%12);if(di>=0){var lx=cx+ri*Math.cos(a),ly=cy+ri*Math.sin(a);h+='<text x="'+lx+'" y="'+ly+'" text-anchor="middle" dominant-baseline="central" fill="var(--txd)" font-size="9" font-family="-apple-system,monospace">'+sc.d[di]+'</text>'}}}
  h+='<text x="'+cx+'" y="'+(cy-8)+'" text-anchor="middle" fill="var(--tx)" font-size="18" font-weight="700" font-family="-apple-system,monospace">'+N[key]+'</text>';
  h+='<text x="'+cx+'" y="'+(cy+12)+'" text-anchor="middle" fill="var(--txd)" font-size="11" font-family="-apple-system,monospace">'+sn.split('/')[0].trim()+'</text>';
  svg.innerHTML=h;
  var info=document.getElementById('cr-info'),nl=sc.i.map(function(iv,idx){var ni=(key+iv)%12;return'<span style="background:'+NC[iv]+';color:'+(iv<3||iv===7?'#1a1a1e':'#fff')+'">'+N[ni]+' ('+sc.d[idx]+')</span>'}).join('');
  var hs=[];for(var i=0;i<sc.i.length;i++){var nx=sc.i[(i+1)%sc.i.length]||12;hs.push(((nx||12)-sc.i[i]+12)%12)}
  info.innerHTML='<h3>'+N[key]+' '+sn+'</h3><div class="cin">'+nl+'</div><p style="margin-top:8px">Èü≥Á®ã„Éë„Çø„Éº„É≥: '+hs.join(' - ')+'</p><p style="margin-top:4px">ÊßãÊàêÈü≥Êï∞: '+sc.i.length+'Èü≥</p>'}

// Init
;(function(){
  ['dia-k','cs-k','cr-k'].forEach(function(id){fk(document.getElementById(id))});
  fsc(document.getElementById('cr-s'));
  ['dia-k','dia-t','dia-v','dia-r','dia-f'].forEach(function(id){document.getElementById(id).addEventListener('change',rDia)});
  ['cs-k','cs-r','cs-f'].forEach(function(id){document.getElementById(id).addEventListener('change',rCS)});
  ['cr-k','cr-s'].forEach(function(id){document.getElementById(id).addEventListener('change',rCR)});
  rDia();rCS();rCR()
})();
</script>
</body>
</html>
